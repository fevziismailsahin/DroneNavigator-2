<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NATO Military Drone Swarm Simulation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #0a1929;
            color: #e0e0e0;
            font-family: 'Roboto', sans-serif;
        }
        .simulation-container {
            position: relative;
            border-radius: 8px;
            background-color: #132f4c;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .control-panel {
            background-color: #173a5e;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .stats-panel {
            background-color: #173a5e;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .btn-primary {
            background-color: #0059b2;
            border-color: #0059b2;
        }
        .btn-danger {
            background-color: #c70011;
            border-color: #c70011;
        }
        .btn-success {
            background-color: #087f5b;
            border-color: #087f5b;
        }
        h1, h2, h3 {
            color: #66b2ff;
        }
        .card {
            background-color: #1e4976;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 1rem;
        }
        .card-header {
            background-color: #173a5e;
            color: #66b2ff;
            font-weight: bold;
        }
        .progress {
            height: 20px;
            background-color: #0a1929;
        }
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(10, 25, 41, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            border-radius: 8px;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        .status-badge {
            font-size: 0.9rem;
            padding: 0.4rem 0.8rem;
        }
        .navbar {
            background-color: #173a5e;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .navbar-brand {
            font-weight: bold;
            color: #66b2ff;
        }
        .sim-title {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(19, 47, 76, 0.8);
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            z-index: 900;
        }
        #simulation-view {
            min-height: 500px;
            border-radius: 8px;
            overflow: hidden;
        }
        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
            color: #fff;
        }
        .stat-label {
            color: #66b2ff;
            font-size: 0.9rem;
        }
        .metric-card {
            padding: 0.5rem;
            text-align: center;
            background-color: #132f4c;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-drone-alt"></i> NATO MILITARY DRONE SWARM SIMULATION
            </a>
            <div class="ms-auto">
                <span id="simulation-status-badge" class="badge status-badge bg-secondary">
                    <i class="fas fa-circle-notch fa-spin me-1"></i> Initializing
                </span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="simulation-container">
                    <div id="loading-overlay" class="loading-overlay">
                        <div class="spinner-border text-light" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div class="sim-title">
                        <span id="step-counter">Step: 0</span>
                    </div>
                    <div id="simulation-view" class="text-center">
                        <img id="simulation-image" src="" class="img-fluid rounded" alt="Simulation Visualization">
                    </div>
                </div>
                
                <div class="control-panel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 class="mb-0"><i class="fas fa-gamepad me-2"></i>Simulation Controls</h3>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <button id="start-btn" class="btn btn-success w-100">
                                <i class="fas fa-play me-1"></i> Start Simulation
                            </button>
                        </div>
                        <div class="col-md-4 mb-2">
                            <button id="stop-btn" class="btn btn-warning w-100" disabled>
                                <i class="fas fa-pause me-1"></i> Pause
                            </button>
                        </div>
                        <div class="col-md-4 mb-2">
                            <button id="reset-btn" class="btn btn-danger w-100">
                                <i class="fas fa-redo me-1"></i> Reset
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="stats-panel">
                    <h3 class="mb-3"><i class="fas fa-chart-line me-2"></i>Simulation Statistics</h3>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            <i class="fas fa-drone me-2"></i>Drone Status
                        </div>
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="metric-card">
                                        <div class="stat-value" id="drones-alive">0</div>
                                        <div class="stat-label">Drones Active</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-card">
                                        <div class="stat-value" id="drones-total">0</div>
                                        <div class="stat-label">Total Drones</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <label class="form-label mb-1">Drone Survival Rate</label>
                                <div class="progress">
                                    <div id="drone-progress" class="progress-bar bg-info" role="progressbar" style="width: 0%">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            <i class="fas fa-crosshairs me-2"></i>Mission Status
                        </div>
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="metric-card">
                                        <div class="stat-value" id="targets-destroyed">0</div>
                                        <div class="stat-label">Targets Destroyed</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-card">
                                        <div class="stat-value" id="targets-total">0</div>
                                        <div class="stat-label">Total Targets</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <label class="form-label mb-1">Mission Completion</label>
                                <div class="progress">
                                    <div id="mission-progress" class="progress-bar bg-success" role="progressbar" style="width: 0%">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-tachometer-alt me-2"></i>Performance Metrics
                        </div>
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="metric-card">
                                        <div class="stat-value" id="exchange-ratio">0.0</div>
                                        <div class="stat-label">Exchange Ratio</div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-card">
                                        <div class="stat-value" id="time-steps">0</div>
                                        <div class="stat-label">Time Steps</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-4 py-3 text-center text-muted">
        <div class="container">
            <small>NATO Military Drone Swarm Simulation &copy; 2025</small>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            let updateInterval;
            const statusBadge = $('#simulation-status-badge');
            const loadingOverlay = $('#loading-overlay');
            
            // Initial update
            updateSimulationStatus();
            
            // Hide loading initially
            loadingOverlay.hide();
            
            // Start simulation
            $('#start-btn').click(function() {
                loadingOverlay.show();
                $.post('/api/start_simulation', function(data) {
                    if (data.status === 'success') {
                        $('#start-btn').prop('disabled', true);
                        $('#stop-btn').prop('disabled', false);
                        $('#reset-btn').prop('disabled', true);
                        
                        statusBadge.removeClass('bg-secondary bg-danger bg-success').addClass('bg-primary');
                        statusBadge.html('<i class="fas fa-running me-1"></i> Running');
                        
                        // Start regular updates
                        updateInterval = setInterval(updateSimulationStatus, 500);
                    }
                    loadingOverlay.hide();
                });
            });
            
            // Stop simulation
            $('#stop-btn').click(function() {
                loadingOverlay.show();
                $.post('/api/stop_simulation', function(data) {
                    if (data.status === 'success') {
                        $('#start-btn').prop('disabled', false);
                        $('#stop-btn').prop('disabled', true);
                        $('#reset-btn').prop('disabled', false);
                        
                        statusBadge.removeClass('bg-primary bg-secondary bg-success').addClass('bg-warning');
                        statusBadge.html('<i class="fas fa-pause me-1"></i> Paused');
                        
                        // Stop updates
                        clearInterval(updateInterval);
                        // But do one more update to get latest state
                        updateSimulationStatus();
                    }
                    loadingOverlay.hide();
                });
            });
            
            // Reset simulation
            $('#reset-btn').click(function() {
                loadingOverlay.show();
                $.post('/api/reset_simulation', function(data) {
                    if (data.status === 'success') {
                        $('#start-btn').prop('disabled', false);
                        $('#stop-btn').prop('disabled', true);
                        $('#reset-btn').prop('disabled', false);
                        
                        statusBadge.removeClass('bg-primary bg-warning bg-danger').addClass('bg-secondary');
                        statusBadge.html('<i class="fas fa-sync me-1"></i> Ready');
                        
                        // Stop updates
                        clearInterval(updateInterval);
                        // But do one more update to get latest state
                        updateSimulationStatus();
                    }
                    loadingOverlay.hide();
                });
            });
            
            // Function to update simulation status
            function updateSimulationStatus() {
                $.get('/api/simulation_status', function(data) {
                    // Update step counter
                    $('#step-counter').text('Step: ' + data.step);
                    
                    // Update statistics
                    if (data.stats) {
                        const stats = data.stats;
                        
                        // Drone stats
                        $('#drones-alive').text(stats.drones_alive || 0);
                        $('#drones-total').text(stats.total_drones || 0);
                        
                        const dronePercent = stats.total_drones ? 
                            Math.round((stats.drones_alive / stats.total_drones) * 100) : 0;
                        $('#drone-progress').css('width', dronePercent + '%').text(dronePercent + '%');
                        
                        // Target stats
                        const targetsDestroyed = stats.total_targets - (stats.targets_remaining || 0);
                        $('#targets-destroyed').text(targetsDestroyed);
                        $('#targets-total').text(stats.total_targets || 0);
                        
                        const missionPercent = stats.total_targets ? 
                            Math.round((targetsDestroyed / stats.total_targets) * 100) : 0;
                        $('#mission-progress').css('width', missionPercent + '%').text(missionPercent + '%');
                        
                        // Performance metrics
                        const dronesLost = stats.total_drones - stats.drones_alive;
                        const ratio = dronesLost > 0 ? (targetsDestroyed / dronesLost).toFixed(2) : "∞";
                        $('#exchange-ratio').text(ratio);
                        $('#time-steps').text(stats.step_count || data.step);
                    }
                    
                    // Update simulation visualization
                    if (data.plot_data) {
                        $('#simulation-image').attr('src', 'data:image/png;base64,' + data.plot_data);
                    }
                    
                    // Check if simulation is complete
                    if (data.complete) {
                        clearInterval(updateInterval);
                        $('#start-btn').prop('disabled', true);
                        $('#stop-btn').prop('disabled', true);
                        $('#reset-btn').prop('disabled', false);
                        
                        statusBadge.removeClass('bg-primary bg-warning bg-secondary').addClass('bg-success');
                        statusBadge.html('<i class="fas fa-check-circle me-1"></i> Complete');
                    }
                });
            }
        });
    </script>
</body>
</html>